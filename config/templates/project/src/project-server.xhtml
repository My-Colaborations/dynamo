<f:view xmlns:h="http://java.sun.com/jsf/html"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:fn="http://java.sun.com/jsp/jstl/functions"
        xmlns:g="http://code.google.com/p/ada-ado/generator"
        xmlns:f="http://java.sun.com/jsf/core"
        file="#{projectName}-server.adb">-----------------------------------------------------------------------
--  #{fn:capitalize(projectName)}-server -- Application server
<ui:include src="../../licenses/license-ada.xhtml"/>
-----------------------------------------------------------------------
with Ada.Exceptions;
#{''}
with Util.Log.Loggers;
#{''}
with AWS.Config.Set;
with ASF.Server.Web;
with AWA.Setup.Applications;
with ADO.Drivers;
--  with ADO.Sqlite;
#{''}
with #{fn:capitalize(projectName)}.Applications;
procedure #{fn:capitalize(projectName)}.Server is
#{''}
   Log     : constant Util.Log.Loggers.Logger := Util.Log.Loggers.Create ("#{fn:capitalize(projectName)}.Server");

   App     : constant #{fn:capitalize(projectName)}.Applications.Application_Access := new #{fn:capitalize(projectName)}.Applications.Application;
#{''}
   procedure Configure (Config : in out AWS.Config.Object);
#{''}
   procedure Setup is
     new AWA.Setup.Applications.Configure (#{fn:capitalize(projectName)}.Applications.Application'Class,
                                           #{fn:capitalize(projectName)}.Applications.Application_Access,
                                           #{fn:capitalize(projectName)}.Applications.Initialize);
#{''}

   WS      : ASF.Server.Web.AWS_Container;
#{''}
   procedure Configure (Config : in out AWS.Config.Object) is
   begin
      AWS.Config.Set.Input_Line_Size_Limit (1_000_000);
      AWS.Config.Set.Max_Connection (Config, 2);
      AWS.Config.Set.Accept_Queue_Size (Config, 100);
      AWS.Config.Set.Send_Buffer_Size (Config, 128 * 1024);
      AWS.Config.Set.Upload_Size_Limit (Config, 100_000_000);
   end Configure;
#{''}
begin
   --  Initialize the database drivers (all of them or specific ones).
   ADO.Drivers.Initialize;
   --  ADO.Sqlite.Initialize;
   WS.Configure (Configure'Access);
   WS.Start;
   Log.Info ("Connect you browser to: http://localhost:8080{0}/index.html",
             #{fn:capitalize(projectName)}.Applications.CONTEXT_PATH);
   Setup (WS, App, #{fn:capitalize(projectName)}.Applications.CONFIG_PATH,
          #{fn:capitalize(projectName)}.Applications.CONTEXT_PATH);

   delay 365.0 * 24.0 * 3600.0;

   App.Close;
exception
   when E : others =>
      Log.Error ("Exception in server: " &amp;
                 Ada.Exceptions.Exception_Name (E) &amp; ": " &amp;
                 Ada.Exceptions.Exception_Message (E));
end #{fn:capitalize(projectName)}.Server;
</f:view>
