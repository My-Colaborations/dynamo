<f:view xmlns:h="http://java.sun.com/jsf/html"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:fn="http://java.sun.com/jsp/jstl/functions"
        xmlns:g="http://code.google.com/p/ada-ado/generator"
        xmlns:f="http://java.sun.com/jsf/core"
        file="#{model.package}.ads">-----------------------------------------------------------------------
--  #{model.name} -- #{model.name}
--  Copyright (C) 2009, 2010 Stephane Carrez
--  Written by Stephane Carrez (Stephane.Carrez@gmail.com)
--
--  Licensed under the Apache License, Version 2.0 (the "License");
--  you may not use this file except in compliance with the License.
--  You may obtain a copy of the License at
--
--      http://www.apache.org/licenses/LICENSE-2.0
--
--  Unless required by applicable law or agreed to in writing, software
--  distributed under the License is distributed on an "AS IS" BASIS,
--  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
--  See the License for the specific language governing permissions and
--  limitations under the License.
-----------------------------------------------------------------------

with ADO.Databases;
with ADO.Sessions;
with ADO.Objects;
with ADO.Statements;
with ADO.SQL;
with Ada.Calendar;
with Ada.Containers.Vectors;
with Ada.Strings.Unbounded;

with EL.Objects;
package #{model.name} is

   use Ada.Calendar;
   use Ada.Strings.Unbounded;
   use ADO.Objects;
   use ADO.Databases;
   use ADO.Statements;
<h:list value="#{model.tables}" var="table">
   --  --------------------
   --  #{table.comment}
   --  --------------------
   type #{table.type} is new ADO.Objects.Object_Ref with null record;
<h:list value="#{table.members}" var="column">
<h:panelGroup rendered="#{not column.isVersion}">
   --  Set #{column.comment}
   procedure Set_#{fn:capitalize(column.name)} (Object : in out #{fn:capitalize(table.type)};
                  #{g:indent(column.name)} Value  : in #{column.type});
<h:panelGroup rendered="#{column.type = 'String'}">
   procedure Set_#{fn:capitalize(column.name)} (Object : in out #{fn:capitalize(table.type)};
                  #{g:indent(column.name)} Value : in Unbounded_String);
</h:panelGroup>
   --  Get #{column.comment}
   function Get_#{fn:capitalize(column.name)} (Object : in #{fn:capitalize(table.type)})
                 return #{column.type};
<h:panelGroup rendered="#{column.type = 'String'}">
   function Get_#{fn:capitalize(column.name)} (Object : in #{fn:capitalize(table.type)})
                 return Unbounded_String;
</h:panelGroup>
</h:panelGroup>
</h:list>

   --  Internal method to allocate the Object_Record instance
   procedure Allocate (Object : in out #{fn:capitalize(table.type)});

   --  Copy of the object.
   function Copy (Object : #{fn:capitalize(table.type)}) return #{fn:capitalize(table.type)};

   --  Load the entity identified by 'Id'.
   --  Raises the NOT_FOUND exception if it does not exist.
   procedure Load (Object  : in out #{fn:capitalize(table.type)};
                   Session : in out ADO.Sessions.Session'Class;
                   Id      : in #{g:adaType(table.primaryKeyType)});

   --  Find and load the entity.
   procedure Find (Object  : in out #{fn:capitalize(table.type)};
                   Session : in out ADO.Sessions.Session'Class;
                   Query   : in ADO.SQL.Query'Class;
                   Found   : out Boolean);

   --  Save the entity.  If the entity does not have an identifier, an identifier is allocated
   --  and it is inserted in the table.  Otherwise, only data fields which have been changed
   --  are updated.
   procedure Save (Object  : in out #{fn:capitalize(table.type)};
                   Session : in out ADO.Sessions.Master_Session'Class);

   --  Delete the entity.
   procedure Delete (Object  : in out #{fn:capitalize(table.type)};
                     Session : in out ADO.Sessions.Master_Session'Class);

   function Get_Value (Item : in #{fn:capitalize(table.type)};
                       Name : in String) return EL.Objects.Object;

   package #{fn:capitalize(table.type)}_Vectors is
      new Ada.Containers.Vectors (Index_Type   => Natural,
                                  Element_Type => #{fn:capitalize(table.type)},
                                  "="          => "=");
   subtype #{fn:capitalize(table.type)}_Vector is #{fn:capitalize(table.type)}_Vectors.Vector;

   procedure List (Object  : in out #{fn:capitalize(table.type)}_Vector;
                   Session : in out ADO.Sessions.Session'Class;
                   Query   : in ADO.SQL.Query'Class);
</h:list>

private
<h:list value="#{model.tables}" var="table">
   #{fn:toUpperCase(table.type)}_NAME : aliased constant String := "#{table.table}";
   <h:list value="#{table.members}" var="column">
   #{fn:toUpperCase(column.name)}_NAME : aliased constant String := "#{column.name}";
   </h:list>

   #{fn:toUpperCase(table.type)}_TABLE : aliased constant ADO.Schemas.Class_Mapping :=
     (Count => #{table.members.size},
      Table => #{fn:toUpperCase(table.type)}_NAME'Access,
      Members => (<h:list value="#{table.members}" var="column">
         #{fn:toUpperCase(column.name)}_NAME'Access
      </h:list>)
     );

   type #{fn:capitalize(table.type)}_Impl is
      new ADO.Objects.Object_Record (Key_Type => ADO.Objects.KEY_INTEGER,
                                     Of_Class => #{fn:toUpperCase(table.type)'Access)
   with record<h:list value="#{table.members}" var="column">
       #{fn:capitalize(column.name)} : #{g:adaType(column.type)};</h:list>
   end record;

   type #{fn:capitalize(table.type)}_Access is access all #{fn:capitalize(table.type)}_Impl;

   overriding
   procedure Destroy (Object : access #{fn:capitalize(table.type)}_Impl);

   overriding
   procedure Find (Object  : in out #{fn:capitalize(table.type)}_Impl;
                   Session : in out ADO.Sessions.Session'Class;
                   Query   : in ADO.SQL.Query'Class;
                   Found   : out Boolean);
   
   procedure Load (Object  : in out #{fn:capitalize(table.type)}_Impl;
                   Session : in out ADO.Sessions.Session'Class;
                   Query   : in ADO.SQL.Query'Class);

   overriding
   procedure Save (Object  : in out #{fn:capitalize(table.type)}_Impl;
                   Session : in out ADO.Sessions.Master_Session'Class);
   
   procedure Create (Object  : in out #{fn:capitalize(table.type)}_Impl;
                     Session : in out ADO.Sessions.Master_Session'Class);

   overriding
   procedure Delete (Object  : in out #{fn:capitalize(table.type)}_Impl;
                     Session : in out ADO.Sessions.Master_Session'Class);


   procedure Set_Field (Object : in out #{fn:capitalize(table.type)}'Class;
                        Impl   : out #{fn:capitalize(table.type)}_Access;
                        Field  : in Positive);
</h:list>

end #{model.name};
</f:view>